# New API Render 部署配置
# 文档: https://render.com/docs/blueprint-spec

services:
  # Redis 缓存服务
  - type: redis
    name: blessing-ai-redis
    plan: free
    ipAllowList: []

  # Web 服务
  - type: web
    name: blessing-ai-new-api
    runtime: docker
    repo: https://github.com/MOFANCITY/new-api.git
    branch: main
    plan: free
    envVars:
      # 数据库配置 - 使用 Supabase PostgreSQL（需手动设置）
      - key: SQL_DSN
        sync: false

      # 数据库类型
      - key: SQL_TYPE
        value: postgres

      # Redis 连接字符串（自动从 Redis 服务获取）
      - key: REDIS_CONN_STRING
        fromService:
          type: redis
          name: blessing-ai-redis
          property: connectionString

      # 端口
      - key: PORT
        value: 3000

      # 会话密钥（自动生成）
      - key: SESSION_SECRET
        generateValue: true

      # 是否关闭注册（建议生产环境关闭）
      - key: DISABLE_REGISTER
        value: "false"

      # 日志级别
      - key: LOG_LEVEL
        value: info

      # 是否启用频率限制
      - key: ENABLE_FREQUENCY_LIMIT
        value: "true"

      # 是否启用数据监控
      - key: ENABLE_DATA_MONITOR
        value: "true"

      # 时区
      - key: TZ
        value: Asia/Shanghai

    healthCheckPath: /api/status

    # 依赖 Redis 服务
    dependsOn:
      - blessing-ai-redis

    # 自动部署
    autoDeploy: true
